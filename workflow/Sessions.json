{
  "data": {
    "metaData": {
      "id": "",
      "statusField": "sessions.status.sessionStatus"
    },
    "nodes": [
      {
        "id": "node1613390014244",
        "x": -143.42,
        "y": 441.29,
        "height": 41,
        "width": 104,
        "clazz": "startEvent",
        "label": "Start Event",
        "className": "start-event",
        "icon": {
          "name": "play-circle",
          "color": "hsl(154, 64%, 49%)"
        },
        "attachment": {}
      },
      {
        "id": "node1613390095196",
        "x": 318.36,
        "y": 272.48,
        "height": 41,
        "width": 201,
        "clazz": "updateRecord",
        "label": "Update Record to Pending Company User APPROVE",
        "className": "update-record",
        "icon": {
          "name": "edit",
          "color": "hsl(189, 87%, 50%)"
        },
        "attachment": {
          "field": "sessions / status",
          "fieldValue": "'-MT_Y0f-hgT92Kdk5APL'"
        }
      },
      {
        "id": "node1613390323051",
        "x": 842,
        "y": 242,
        "height": 101,
        "width": 176,
        "clazz": "userTask",
        "label": "Company User Approve",
        "className": "user-task",
        "icon": {
          "name": "user",
          "color": "hsl(235, 71%, 65%)"
        },
        "attachment": {
          "user": "companyUser.companyUserProfiles.owner"
        },
        "outcomes": [
          {
            "text": "Accept",
            "id": "outcome1613390338492",
            "idx": 1
          },
          {
            "text": "Reject",
            "id": "outcome1613390341620",
            "idx": 2
          }
        ]
      },
      {
        "id": "node1613390394011",
        "x": 1018,
        "y": 181,
        "height": 40,
        "width": 200,
        "clazz": "updateRecord",
        "label": "Company User Update Session Record to Approved",
        "className": "update-record",
        "icon": {
          "name": "edit",
          "color": "hsl(189, 87%, 50%)"
        },
        "attachment": {
          "field": "sessions / status",
          "fieldValue": "'-MT_Xz9l8P0BnRSUB8fb'"
        }
      },
      {
        "id": "node1613390736043",
        "x": 1060,
        "y": 342,
        "height": 40,
        "width": 200,
        "clazz": "updateRecord",
        "label": "Company User Update Session Record to Rejected",
        "className": "update-record",
        "icon": {
          "name": "edit",
          "color": "hsl(189, 87%, 50%)"
        },
        "attachment": {
          "field": "sessions / status",
          "fieldValue": "'-MT_Y-bB3Tef-JAlj2G0'"
        }
      },
      {
        "id": "node1613390905626",
        "x": 1176.13,
        "y": 76.16,
        "height": 41,
        "width": 201,
        "clazz": "updateRecord",
        "label": "Company User Update Record to Booked",
        "className": "update-record",
        "icon": {
          "name": "edit",
          "color": "hsl(189, 87%, 50%)"
        },
        "attachment": {
          "field": "sessions / isBooked",
          "fieldValue": "true"
        }
      },
      {
        "id": "node1613463136747",
        "x": 1948.58,
        "y": 212.35,
        "height": 101,
        "width": 201,
        "clazz": "userTask",
        "label": "Did Session Happen? Company User",
        "className": "user-task",
        "icon": {
          "name": "user",
          "color": "hsl(235, 71%, 65%)"
        },
        "attachment": {
          "user": "mentor.mentors.owner"
        },
        "outcomes": [
          {
            "text": "Session went on as planned",
            "id": "outcome1613463196767",
            "idx": 1
          },
          {
            "text": "Session did not happen",
            "id": "outcome1613463200440",
            "idx": 2
          }
        ]
      },
      {
        "id": "node1613463588574",
        "x": 2042,
        "y": 116,
        "height": 40,
        "width": 199,
        "clazz": "updateRecord",
        "label": "Session Went On Company",
        "className": "update-record",
        "icon": {
          "name": "edit",
          "color": "hsl(189, 87%, 50%)"
        },
        "attachment": {
          "field": "sessions / sessionHappen",
          "fieldValue": "true"
        }
      },
      {
        "id": "node1615807978814",
        "x": 1398.28,
        "y": 330.28,
        "height": 41,
        "width": 200,
        "clazz": "updateRecord",
        "label": "Company User Update Record to Rejected",
        "className": "update-record",
        "icon": {
          "name": "pen",
          "color": "hsl(189, 87%, 50%)"
        },
        "attachment": {
          "field": "sessions / rejected",
          "fieldValue": "true"
        }
      },
      {
        "id": "node1615808033582",
        "x": 2143.4285714285716,
        "y": 281,
        "height": 41,
        "width": 197,
        "clazz": "updateRecord",
        "label": "Update Record to Rejected",
        "className": "update-record",
        "icon": {
          "name": "pen",
          "color": "hsl(189, 87%, 50%)"
        },
        "attachment": {
          "field": "sessions / rejected",
          "fieldValue": "true"
        }
      },
      {
        "id": "node1615900642216",
        "x": 325.67,
        "y": 475.32,
        "height": 41,
        "width": 200,
        "clazz": "updateRecord",
        "label": "Update Record to Pending MENTOR APPROVE",
        "className": "update-record",
        "icon": {
          "name": "pen",
          "color": "hsl(189, 87%, 50%)"
        },
        "attachment": {
          "field": "sessions / status",
          "fieldValue": "'-MT_Y0f-hgT92Kdk5APL'"
        }
      },
      {
        "id": "node1615907920654",
        "x": 863.77,
        "y": 411.62,
        "height": 101,
        "width": 133,
        "clazz": "userTask",
        "label": "Mentor Approve",
        "className": "user-task",
        "icon": {
          "name": "user",
          "color": "hsl(235, 71%, 65%)"
        },
        "attachment": {
          "user": "mentor.mentors.owner"
        },
        "outcomes": [
          {
            "text": "Accept",
            "id": "outcome1615907974844",
            "idx": 1
          },
          {
            "text": "Reject",
            "id": "outcome1615907978948",
            "idx": 2
          }
        ]
      },
      {
        "id": "node1615908005991",
        "x": 1099,
        "y": 512,
        "height": 40,
        "width": 200,
        "clazz": "updateRecord",
        "label": "Mentor Update Session Record to Approved",
        "className": "update-record",
        "icon": {
          "name": "pen",
          "color": "hsl(189, 87%, 50%)"
        },
        "attachment": {
          "field": "sessions / status",
          "fieldValue": "'-MT_Xz9l8P0BnRSUB8fb'"
        }
      },
      {
        "id": "node1615908052024",
        "x": 1413.26,
        "y": 512.48,
        "height": 41,
        "width": 201,
        "clazz": "updateRecord",
        "label": "Mentor Update Record to Booked",
        "className": "update-record",
        "icon": {
          "name": "pen",
          "color": "hsl(189, 87%, 50%)"
        },
        "attachment": {
          "field": "sessions / isBooked",
          "fieldValue": "true"
        }
      },
      {
        "id": "node1615908105291",
        "x": 1973.2,
        "y": 489.61,
        "height": 101,
        "width": 201,
        "clazz": "userTask",
        "label": "Did Session Happen? Mentor",
        "className": "user-task",
        "icon": {
          "name": "user",
          "color": "hsl(235, 71%, 65%)"
        },
        "attachment": {
          "user": "companyUser.companyUserProfiles.owner"
        },
        "outcomes": [
          {
            "text": "Session went on as planned",
            "id": "outcome1615908123079",
            "idx": 1
          },
          {
            "text": "Session did not happen",
            "id": "outcome1615908129798",
            "idx": 2
          }
        ]
      },
      {
        "id": "node1615908140334",
        "x": 2230.34,
        "y": 456.04,
        "height": 40,
        "width": 185,
        "clazz": "updateRecord",
        "label": "Session Went On Mentor",
        "className": "update-record",
        "icon": {
          "name": "pen",
          "color": "hsl(189, 87%, 50%)"
        },
        "attachment": {
          "field": "sessions / sessionHappen",
          "fieldValue": "true"
        }
      },
      {
        "id": "node1615908165648",
        "x": 2230.61,
        "y": 585.37,
        "height": 40,
        "width": 197,
        "clazz": "updateRecord",
        "label": "Update Record to Rejected",
        "className": "update-record",
        "icon": {
          "name": "pen",
          "color": "hsl(189, 87%, 50%)"
        },
        "attachment": {
          "field": "sessions / rejected",
          "fieldValue": "true"
        }
      },
      {
        "id": "node1615909073571",
        "x": 1099,
        "y": 637,
        "height": 40,
        "width": 200,
        "clazz": "updateRecord",
        "label": "Mentor Update Session Record to Rejected",
        "className": "update-record",
        "icon": {
          "name": "pen",
          "color": "hsl(189, 87%, 50%)"
        },
        "attachment": {
          "field": "sessions / status",
          "fieldValue": "'-MT_Y-bB3Tef-JAlj2G0'"
        }
      },
      {
        "id": "node1615909129991",
        "x": 1463,
        "y": 648,
        "height": 40,
        "width": 200,
        "clazz": "updateRecord",
        "label": "Mentor Update Record to Rejected",
        "className": "update-record",
        "icon": {
          "name": "pen",
          "color": "hsl(189, 87%, 50%)"
        },
        "attachment": {
          "field": "sessions / rejected",
          "fieldValue": "true"
        }
      },
      {
        "id": "node1615980663486",
        "x": 86.38,
        "y": 329.29,
        "height": 101,
        "width": 150,
        "clazz": "decision",
        "label": "Check Direction",
        "className": "decision",
        "icon": {
          "name": "check-circle",
          "color": "hsl(11, 96%, 62%)"
        },
        "attachment": {},
        "outcomes": [
          {
            "text": "Mentor->CompanyUser",
            "id": "outcome1615980680416",
            "idx": 1,
            "expression": "context.data.direction == \"Mentor->CompanyUser\""
          },
          {
            "text": "CompanyUser->Mentor",
            "id": "outcome1615980694132",
            "idx": 2,
            "expression": "context.data.direction == \"CompanyUser->Mentor\""
          }
        ]
      },
      {
        "id": "node1616155675538",
        "x": 2443,
        "y": 276,
        "height": 40,
        "width": 201,
        "clazz": "updateRecord",
        "label": "Update Record Status to Rejected",
        "className": "update-record",
        "icon": {
          "name": "pen",
          "color": "hsl(189, 87%, 50%)"
        },
        "attachment": {
          "field": "sessions / status",
          "fieldValue": "'-MT_Y-bB3Tef-JAlj2G0'"
        }
      },
      {
        "id": "node1616155703847",
        "x": 2644.55,
        "y": 655.8,
        "height": 41,
        "width": 201,
        "clazz": "updateRecord",
        "label": "Update Record status to rejected",
        "className": "update-record",
        "icon": {
          "name": "pen",
          "color": "hsl(189, 87%, 50%)"
        },
        "attachment": {
          "field": "sessions / status",
          "fieldValue": "'-MT_Y-bB3Tef-JAlj2G0'"
        }
      },
      {
        "id": "node1631620447259",
        "x": 2260,
        "y": 144,
        "width": 124,
        "height": 72,
        "attachment": {
          "user": "mentor.mentors.owner"
        },
        "name": "user-task",
        "clazz": "userTask",
        "label": "Submit Feedback",
        "icon": "user",
        "iconColor": "hsl(235, 71%, 65%)",
        "outcomes": [
          {
            "text": "Submit Feedback",
            "id": "outcome1631620479506",
            "idx": 1
          }
        ]
      },
      {
        "id": "node1631620487844",
        "x": 2552,
        "y": 169,
        "width": 192,
        "height": 41,
        "attachment": {
          "field": "sessions / companyUserReviewGiven",
          "fieldValue": "true"
        },
        "name": "update-record",
        "clazz": "updateRecord",
        "label": "Company User Review Given",
        "icon": "pen",
        "iconColor": "hsl(189, 87%, 50%)"
      },
      {
        "id": "node1631620530726",
        "x": 2476.61,
        "y": 440.15,
        "width": 110,
        "height": 72,
        "attachment": {
          "user": "mentor.mentors.owner"
        },
        "name": "user-task",
        "clazz": "userTask",
        "label": "Submit Review",
        "icon": "user",
        "iconColor": "hsl(235, 71%, 65%)",
        "outcomes": [
          {
            "text": "Submit Review",
            "id": "outcome1631620545376",
            "idx": 1
          }
        ]
      },
      {
        "id": "node1631620557279",
        "x": 2696.09,
        "y": 449.15,
        "width": 180,
        "height": 40,
        "attachment": {
          "field": "sessions / mentorUserReviewGiven",
          "fieldValue": "true"
        },
        "name": "update-record",
        "clazz": "updateRecord",
        "label": "Mentor User Review Given",
        "icon": "pen",
        "iconColor": "hsl(189, 87%, 50%)"
      },
      {
        "id": "node1633958637498",
        "x": 566.78,
        "y": 174.97,
        "width": 201,
        "height": 41,
        "attachment": {
          "script": "//SEND COMPANY USER NOTIFICATION EMAIL\r\nlet dbCall = await tablesRef.child('companyUserProfiles/'+rowData.companyUser)\r\n      .once('value')\r\nlet results = dbCall.val()\r\n\r\n$log(results.owner)\r\n\r\nconst email = await getUserEmailByUID(results.owner)\r\n\r\nconst msg = {\r\n            to: {email},\r\n            from: 'noreply@portal.truealtitude.co.uk',\r\n            subject: 'True Altitude Portal: You have a booking request to respond to!',\r\n            text: 'Hi ' + results.name + ', \\n\\r' + 'You have a session booking request from a mentor on our portal! Please click here to login. portal.truealtitude.co.uk',\r\n            html: 'Hi ' + results.name + ', <br/>' + '<br/> You have a session booking request from a mentor on our portal! Please check your portal notifications to respond. <br/> <br/> Please click <a href=\"portal.truealtitude.co.uk/auth\">here</a> to login.'            }\r\n\r\nlet nEmail = await sendEmail(msg)\r\n"
        },
        "name": "script-task",
        "clazz": "scriptTask",
        "label": "Email Task (Mentor-CompanyUser)",
        "icon": {
          "name": "terminal",
          "color": "hsl(218, 54%, 20%)"
        }
      },
      {
        "id": "node1633959329261",
        "x": 600.75,
        "y": 394.4,
        "width": 201,
        "height": 40,
        "attachment": {
          "script": "//SEND COMPANY USER NOTIFICATION EMAIL\r\nlet dbCall = await tablesRef.child('mentors/'+rowData.mentor)\r\n      .once('value')\r\nlet results = dbCall.val()\r\n\r\n$log(results.owner, '123<<<')\r\n\r\nconst email = await getUserEmailByUID(results.owner)\r\n\r\nconst msg = {\r\n            to: {email},\r\n            from: 'noreply@portal.truealtitude.co.uk',\r\n            subject: 'True Altitude Portal: You have a booking request to respond to!',\r\n            text: 'Hi ' + results.name + ', \\n\\r' + 'You have a session booking request from a company user on our portal! Please click here to login. portal.truealtitude.co.uk',\r\n            html: 'Hi ' + results.name + ', <br/>' + '<br/> You have a session booking request from a company user on our portal! Please check your portal notifications to respond. <br/> <br/> Please click <a href=\"portal.truealtitude.co.uk/auth\">here</a> to login.'            }\r\n\r\nlet nEmail = await sendEmail(msg)\r\n"
        },
        "name": "script-task",
        "clazz": "scriptTask",
        "label": "Email Task  (Company User->Mentor)",
        "icon": {
          "name": "terminal",
          "color": "hsl(218, 54%, 20%)"
        }
      },
      {
        "id": "node1633959446104",
        "x": 1406.65,
        "y": -10.1,
        "width": 201,
        "height": 41,
        "attachment": {
          "script": "//SEND COMPANY USER NOTIFICATION EMAIL\r\nlet dbCall = await tablesRef.child('companyUserProfiles/'+rowData.companyUser)\r\n      .once('value')\r\nlet results = dbCall.val()\r\n\r\nlet dbCall2 = await tablesRef.child('mentors/' + rowData.mentor).once('value')\r\nlet results2 = dbCall2.val()\r\n\r\nconst milliseconds = context.data.sDate\r\nconst dateObject = new Date(milliseconds)\r\n\r\nconst endDateObject = new Date(context.data.eDate)\r\n\r\nvar dif = endDateObject.getTime() - dateObject.getTime();\r\n\r\nlet h,m,s;\r\nh = Math.floor(dif/1000/60/60);\r\nm = Math.floor((dif/1000/60/60 - h)*60);\r\ns = Math.floor(((dif/1000/60/60 - h)*60 - m)*60);\r\n\r\n// const sessionDay = dateObject.toLocaleString(\"en-US\", {day: \"numeric\"})\r\n// const sessionMonth = dateObject.toLocaleString(\"en-US\", {month: \"numeric\"})\r\n// const sessionYear = dateObject.toLocaleString(\"en-US\", {year: \"numeric\"})\r\n// const sessionHour = dateObject.toLocaleString(\"en-US\", {hour: \"numeric\"})\r\n// const sessionMinute = dateObject.toLocaleString(\"en-US\", {minute: \"numeric\"})\r\n\r\nconst sessionDay = dateObject.getDate()\r\nconst sessionMonth = dateObject.getMonth()\r\nconst sessionYear = dateObject.getFullYear()\r\nconst sessionHour = dateObject.getHours()\r\nconst sessionMinute = dateObject.getMinutes()\r\n\r\nconst dateArray = [sessionYear, sessionMonth + 1, sessionDay, sessionHour, sessionMinute]\r\n\r\nconst mentorEmail = await getUserEmailByUID(results2.owner)\r\nconst ownerEmail = await getUserEmailByUID(results.owner)\r\n\r\nconst event = {\r\n  start: dateArray,\r\n  duration: { hours: h, minutes: m },\r\n  title: 'Investment Portal Session: ' + context.data.name,\r\n  description: 'True Altitude Session',\r\n  status: 'CONFIRMED',\r\n  organizer: { name: results2.name + ' ' + results2.secondName, email: mentorEmail },\r\n  attendees: [\r\n    { name: results.name + ' ' + results.secondName, email: ownerEmail, rsvp: true, partstat: 'ACCEPTED', role: 'REQ-PARTICIPANT' }\r\n  ]\r\n}\r\n\r\nconst attachment = await generateSCIData(event)\r\n\r\nconst email = await getUserEmailByUID(results2.owner)\r\n\r\nconst msg = {\r\n            to: {email},\r\n            from: 'noreply@portal.truealtitude.co.uk',\r\n            subject: 'True Altitude Portal: Your booking request has been approved!',\r\n            text: 'Hi ' + results2.name + ', \\n\\r' + 'You booking request has been approved by a company user! Please click here to login. portal.truealtitude.co.uk',\r\n            html: 'Hi ' + results2.name + ', <br/>' + '<br/> You booking request has been approved by a company user! An ICS file is attached to this email so you can add the session to a calendar of your choice. <br/> <br/> Please click <a href=\"portal.truealtitude.co.uk/auth\">here</a> to login.',\r\n            attachments: [\r\n            {\r\n              content: attachment,\r\n              filename: \"event.ics\",\r\n              type: \"application/pdf\",\r\n              disposition: \"attachment\"\r\n            }\r\n          ]\r\n}\r\n\r\nlet nEmail = await sendEmail(msg)\r\n"
        },
        "name": "script-task",
        "clazz": "scriptTask",
        "label": "Email Task (Mentor->CompanyUser) Response",
        "icon": {
          "name": "terminal",
          "color": "hsl(218, 54%, 20%)"
        }
      },
      {
        "id": "node1633959638767",
        "x": 1503.18,
        "y": 412.55,
        "width": 200,
        "height": 41,
        "attachment": {
          "script": "//SEND COMPANY USER NOTIFICATION EMAIL\r\nlet dbCall = await tablesRef.child('companyUserProfiles/'+rowData.companyUser)\r\n      .once('value')\r\nlet results = dbCall.val()\r\n\r\nlet dbCall2 = await tablesRef.child('mentors/' + rowData.mentor).once('value')\r\nlet results2 = dbCall2.val()\r\n\r\nconst milliseconds = context.data.sDate\r\nconst dateObject = new Date(milliseconds)\r\n\r\nconst endDateObject = new Date(context.data.eDate)\r\n\r\nvar dif = endDateObject.getTime() - dateObject.getTime();\r\n\r\nlet h,m,s;\r\nh = Math.floor(dif/1000/60/60);\r\nm = Math.floor((dif/1000/60/60 - h)*60);\r\ns = Math.floor(((dif/1000/60/60 - h)*60 - m)*60);\r\n\r\n// const sessionDay = dateObject.toLocaleString(\"en-US\", {day: \"numeric\"})\r\n// const sessionMonth = dateObject.toLocaleString(\"en-US\", {month: \"numeric\"})\r\n// const sessionYear = dateObject.toLocaleString(\"en-US\", {year: \"numeric\"})\r\n// const sessionHour = dateObject.toLocaleString(\"en-US\", {hour: \"numeric\"})\r\n// const sessionMinute = dateObject.toLocaleString(\"en-US\", {minute: \"numeric\"})\r\n\r\nconst sessionDay = dateObject.getDate()\r\nconst sessionMonth = dateObject.getMonth()\r\nconst sessionYear = dateObject.getFullYear()\r\nconst sessionHour = dateObject.getHours()\r\nconst sessionMinute = dateObject.getMinutes()\r\n\r\nconst dateArray = [sessionYear, sessionMonth + 1, sessionDay, sessionHour, sessionMinute]\r\n\r\nconst mentorEmail = await getUserEmailByUID(results2.owner)\r\nconst ownerEmail = await getUserEmailByUID(results.owner)\r\n\r\nconst event = {\r\n  start: dateArray,\r\n  duration: { hours: h, minutes: m },\r\n  title: 'Investment Portal Session: ' + context.data.name,\r\n  description: 'True Altitude Session',\r\n  status: 'CONFIRMED',\r\n  organizer: { name: results.name  + ' ' + results.secondName, email: ownerEmail },\r\n  attendees: [\r\n    { name: results2.name + ' ' + results2.secondName, email: mentorEmail, rsvp: true, partstat: 'ACCEPTED', role: 'REQ-PARTICIPANT' }\r\n  ]\r\n}\r\n\r\nconst attachment = await generateSCIData(event)\r\n\r\nconst email = await getUserEmailByUID(results.owner)\r\n\r\nconst msg = {\r\n            to: {email},\r\n            from: 'noreply@portal.truealtitude.co.uk',\r\n            subject: 'True Altitude Portal: Your booking request has been approved!',\r\n            text: 'Hi ' + results.name + ', \\n\\r' + 'You booking request has been approved by a mentor! Please click here to login. portal.truealtitude.co.uk',\r\n            html: 'Hi ' + results.name + ', <br/>' + '<br/> You booking request has been approved by a mentor! An ICS file is attached to this email so you can add the session to a calendar of your choice. <br/> <br/> Please click <a href=\"portal.truealtitude.co.uk/auth\">here</a> to login.',\r\n            attachments: [\r\n            {\r\n              content: attachment,\r\n              filename: \"event.ics\",\r\n              type: \"application/pdf\",\r\n              disposition: \"attachment\"\r\n            }\r\n          ]\r\n}\r\n\r\nlet nEmail = await sendEmail(msg)\r\n"
        },
        "name": "script-task",
        "clazz": "scriptTask",
        "label": "Email Task (CompanyUser->Mentor) Response",
        "icon": {
          "name": "terminal",
          "color": "hsl(218, 54%, 20%)"
        }
      },
      {
        "id": "node1636638248531",
        "x": 703.3081777405887,
        "y": 343.29152215983106,
        "width": 100,
        "height": 41,
        "attachment": {},
        "name": "comment",
        "clazz": "comment",
        "label": "Comment",
        "icon": {
          "name": "comment",
          "color": "hsl(188, 78%, 41%)"
        }
      },
      {
        "id": "node1636971583639",
        "x": 1818.71,
        "y": 408.32,
        "width": 177,
        "height": 40,
        "attachment": {
          "script": "//SEND COMPANY USER NOTIFICATION EMAIL\r\nlet dbCall = await tablesRef.child('companyUserProfiles/'+rowData.companyUser)\r\n      .once('value')\r\nlet results = dbCall.val()\r\n\r\nlet dbCall2 = await tablesRef.child('mentors/' + rowData.mentor).once('value')\r\nlet results2 = dbCall2.val()\r\n\r\nconst milliseconds = context.data.sDate\r\nconst dateObject = new Date(milliseconds)\r\n\r\nconst endDateObject = new Date(context.data.eDate)\r\n\r\nvar dif = endDateObject.getTime() - dateObject.getTime();\r\n\r\nlet h,m,s;\r\nh = Math.floor(dif/1000/60/60);\r\nm = Math.floor((dif/1000/60/60 - h)*60);\r\ns = Math.floor(((dif/1000/60/60 - h)*60 - m)*60);\r\n\r\n// const sessionDay = dateObject.toLocaleString(\"en-US\", {day: \"numeric\"})\r\n// const sessionMonth = dateObject.toLocaleString(\"en-US\", {month: \"numeric\"})\r\n// const sessionYear = dateObject.toLocaleString(\"en-US\", {year: \"numeric\"})\r\n// const sessionHour = dateObject.toLocaleString(\"en-US\", {hour: \"numeric\"})\r\n// const sessionMinute = dateObject.toLocaleString(\"en-US\", {minute: \"numeric\"})\r\n\r\nconst sessionDay = dateObject.getDate()\r\nconst sessionMonth = dateObject.getMonth()\r\nconst sessionYear = dateObject.getFullYear()\r\nconst sessionHour = dateObject.getHours()\r\nconst sessionMinute = dateObject.getMinutes()\r\n\r\nconst dateArray = [sessionYear, sessionMonth + 1, sessionDay, sessionHour, sessionMinute]\r\n\r\nconst mentorEmail = await getUserEmailByUID(results2.owner)\r\nconst ownerEmail = await getUserEmailByUID(results.owner)\r\n\r\nconst event = {\r\n  start: dateArray,\r\n  duration: { hours: h, minutes: m },\r\n  title: 'Investment Portal Session: ' + context.data.name,\r\n  description: 'True Altitude Session',\r\n  status: 'CONFIRMED',\r\n  organizer: { name: results.name  + ' ' + results.secondName, email: ownerEmail },\r\n  attendees: [\r\n    { name: results2.name + ' ' + results2.secondName, email: mentorEmail, rsvp: true, partstat: 'ACCEPTED', role: 'REQ-PARTICIPANT' }\r\n  ]\r\n}\r\n\r\nconst attachment = await generateSCIData(event)\r\n\r\nconst email = await getUserEmailByUID(results2.owner)\r\n\r\nconst msg = {\r\n            to: {email},\r\n            from: 'noreply@portal.truealtitude.co.uk',\r\n            subject: 'True Altitude Portal: New Booked Session!',\r\n            text: 'Hi ' + results2.name + ', \\n\\r' + 'A session you recently approved is now booked! Please click here to login. portal.truealtitude.co.uk',\r\n            html: 'Hi ' + results2.name + ', <br/>' + '<br/> A session you recently approved is now booked! An ICS file is attached to this email so you can add the session to a calendar of your choice. <br/> <br/> Please click <a href=\"portal.truealtitude.co.uk/auth\">here</a> to login.',\r\n            attachments: [\r\n            {\r\n              content: attachment,\r\n              filename: \"event.ics\",\r\n              type: \"application/pdf\",\r\n              disposition: \"attachment\"\r\n            }\r\n          ]\r\n}\r\n\r\nlet nEmail = await sendEmail(msg)\r\n"
        },
        "name": "script-task",
        "clazz": "scriptTask",
        "label": "ICS file send to mentor",
        "icon": {
          "name": "terminal",
          "color": "hsl(218, 54%, 20%)"
        }
      },
      {
        "id": "node1636972398889",
        "x": 1695.54,
        "y": 75.01,
        "width": 201,
        "height": 40,
        "attachment": {
          "script": "//SEND COMPANY USER NOTIFICATION EMAIL\r\nlet dbCall = await tablesRef.child('companyUserProfiles/'+rowData.companyUser)\r\n      .once('value')\r\nlet results = dbCall.val()\r\n\r\nlet dbCall2 = await tablesRef.child('mentors/' + rowData.mentor).once('value')\r\nlet results2 = dbCall2.val()\r\n\r\nconst milliseconds = context.data.sDate\r\nconst dateObject = new Date(milliseconds)\r\n\r\nconst endDateObject = new Date(context.data.eDate)\r\n\r\nvar dif = endDateObject.getTime() - dateObject.getTime();\r\n\r\nlet h,m,s;\r\nh = Math.floor(dif/1000/60/60);\r\nm = Math.floor((dif/1000/60/60 - h)*60);\r\ns = Math.floor(((dif/1000/60/60 - h)*60 - m)*60);\r\n\r\n// const sessionDay = dateObject.toLocaleString(\"en-US\", {day: \"numeric\"})\r\n// const sessionMonth = dateObject.toLocaleString(\"en-US\", {month: \"numeric\"})\r\n// const sessionYear = dateObject.toLocaleString(\"en-US\", {year: \"numeric\"})\r\n// const sessionHour = dateObject.toLocaleString(\"en-US\", {hour: \"numeric\"})\r\n// const sessionMinute = dateObject.toLocaleString(\"en-US\", {minute: \"numeric\"})\r\n\r\nconst sessionDay = dateObject.getDate()\r\nconst sessionMonth = dateObject.getMonth()\r\nconst sessionYear = dateObject.getFullYear()\r\nconst sessionHour = dateObject.getHours()\r\nconst sessionMinute = dateObject.getMinutes()\r\n\r\nconst dateArray = [sessionYear, sessionMonth + 1, sessionDay, sessionHour, sessionMinute]\r\n\r\nconst mentorEmail = await getUserEmailByUID(results2.owner)\r\nconst ownerEmail = await getUserEmailByUID(results.owner)\r\n\r\nconst event = {\r\n  start: dateArray,\r\n  duration: { hours: h, minutes: m },\r\n  title: 'Investment Portal Session: ' + context.data.name,\r\n  description: 'True Altitude Session',\r\n  status: 'CONFIRMED',\r\n  organizer: { name: results2.name  + ' ' + results2.secondName, email: mentorEmail },\r\n  attendees: [\r\n    { name: results.name + ' ' + results.secondName, email: mentorEmail, rsvp: true, partstat: 'ACCEPTED', role: 'REQ-PARTICIPANT' }\r\n  ]\r\n}\r\n\r\nconst attachment = await generateSCIData(event)\r\n\r\nconst email = await getUserEmailByUID(results.owner)\r\n\r\nconst msg = {\r\n            to: {email},\r\n            from: 'noreply@portal.truealtitude.co.uk',\r\n            subject: 'True Altitude Portal: New Booked Session!',\r\n            text: 'Hi ' + results.name + ', \\n\\r' + 'A session you recently approved is now booked! Please click here to login. portal.truealtitude.co.uk',\r\n            html: 'Hi ' + results.name + ', <br/>' + '<br/> A session you recently approved is now booked! An ICS file is attached to this email so you can add the session to a calendar of your choice. <br/> <br/> Please click <a href=\"portal.truealtitude.co.uk/auth\">here</a> to login.',\r\n            attachments: [\r\n            {\r\n              content: attachment,\r\n              filename: \"event.ics\",\r\n              type: \"application/pdf\",\r\n              disposition: \"attachment\"\r\n            }\r\n          ]\r\n}\r\n\r\nlet nEmail = await sendEmail(msg)\r\n"
        },
        "name": "script-task",
        "clazz": "scriptTask",
        "label": "ICS file send to company user",
        "icon": {
          "name": "terminal",
          "color": "hsl(218, 54%, 20%)"
        }
      }
    ],
    "edges": [
      {
        "source": "node1613390014244-right",
        "target": "node1615980663486",
        "endSocket": "left",
        "id": "line-1631013990040",
        "instance": {},
        "label": "Start Event",
        "targetLabel": "Check Direction",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "connector-outcome1615980680416",
        "target": "node1613390095196",
        "endSocket": "left",
        "id": "line-1631013992023",
        "instance": {},
        "label": "Mentor->CompanyUser",
        "targetLabel": "Update Record to Pending Company User APPROVE",
        "expression": "context.data.direction == \"Mentor->CompanyUser\"",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "connector-outcome1613390338492",
        "target": "node1613390394011",
        "endSocket": "left",
        "id": "line-1631013996008",
        "instance": {},
        "label": "Accept",
        "targetLabel": "Company User Update Session Record to Approved",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "node1613390736043-right",
        "target": "node1615807978814",
        "endSocket": "left",
        "id": "line-1631014000871",
        "instance": {},
        "label": "Company User Update Session Record to Rejected",
        "targetLabel": "Company User Update Record to Rejected",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "connector-outcome1613390341620",
        "target": "node1613390736043",
        "endSocket": "left",
        "id": "line-1631014002767",
        "instance": {},
        "label": "Reject",
        "targetLabel": "Company User Update Session Record to Rejected",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "node1613390394011-right",
        "target": "node1613390905626",
        "endSocket": "left",
        "id": "line-1631014005432",
        "instance": {},
        "label": "Company User Update Session Record to Approved",
        "targetLabel": "Company User Update Record to Booked",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "connector-outcome1613463200440",
        "target": "node1615808033582",
        "endSocket": "left",
        "id": "line-1631014014307",
        "instance": {},
        "label": "Session did not happen",
        "targetLabel": "Update Record to Rejected",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "node1615808033582-right",
        "target": "node1616155675538",
        "endSocket": "left",
        "id": "line-1631014015792",
        "instance": {},
        "label": "Update Record to Rejected",
        "targetLabel": "Update Record Status to Rejected",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "connector-outcome1615980694132",
        "target": "node1615900642216",
        "endSocket": "left",
        "id": "line-1631014020274",
        "instance": {},
        "label": "CompanyUser->Mentor",
        "targetLabel": "Update Record to Pending MENTOR APPROVE",
        "expression": "context.data.direction == \"CompanyUser->Mentor\"",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "connector-outcome1615907974844",
        "target": "node1615908005991",
        "endSocket": "left",
        "id": "line-1631014022692",
        "instance": {},
        "label": "Accept",
        "targetLabel": "Mentor Update Session Record to Approved",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "connector-outcome1615907978948",
        "target": "node1615909073571",
        "endSocket": "left",
        "id": "line-1631014024408",
        "instance": {},
        "label": "Reject",
        "targetLabel": "Mentor Update Session Record to Rejected",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "node1615908005991-right",
        "target": "node1615908052024",
        "endSocket": "left",
        "id": "line-1631014026626",
        "instance": {},
        "label": "Mentor Update Session Record to Approved",
        "targetLabel": "Mentor Update Record to Booked",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "node1615909073571-right",
        "target": "node1615909129991",
        "endSocket": "left",
        "id": "line-1631014028420",
        "instance": {},
        "label": "Mentor Update Session Record to Rejected",
        "targetLabel": "Mentor Update Record to Rejected",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "connector-outcome1615908123079",
        "target": "node1615908140334",
        "endSocket": "left",
        "id": "line-1631014032456",
        "instance": {},
        "label": "Session went on as planned",
        "targetLabel": "Session Went On",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "connector-outcome1615908129798",
        "target": "node1615908165648",
        "endSocket": "left",
        "id": "line-1631014033826",
        "instance": {},
        "label": "Session did not happen",
        "targetLabel": "Update Record to Rejected",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "node1615908165648-right",
        "target": "node1616155703847",
        "endSocket": "left",
        "id": "line-1631014035670",
        "instance": {},
        "label": "Update Record to Rejected",
        "targetLabel": "Update Record status to rejected",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "node1615908140334-right",
        "target": "node1631620530726",
        "endSocket": "left",
        "id": "line-1631620554498",
        "instance": {},
        "label": "Session Went On",
        "targetLabel": "Submit Review",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "connector-outcome1631620545376",
        "target": "node1631620557279",
        "endSocket": "left",
        "id": "line-1631620585019",
        "instance": {},
        "label": "Submit Review",
        "targetLabel": "Mentor Review Given",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "connector-outcome1631620479506",
        "target": "node1631620487844",
        "endSocket": "left",
        "id": "line-1631621823953",
        "instance": {},
        "label": "Submit Feedback",
        "targetLabel": "Company User Review Given",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "connector-outcome1613463196767",
        "target": "node1613463588574",
        "endSocket": "left",
        "id": "line-1631621826874",
        "instance": {},
        "label": "Session went on as planned",
        "targetLabel": "Session Went On",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "node1613463588574-right",
        "target": "node1631620447259",
        "endSocket": "left",
        "id": "line-1631621830368",
        "instance": {},
        "label": "Session Went On",
        "targetLabel": "Submit Feedback",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "node1613390095196-right",
        "target": "node1633958637498",
        "endSocket": "left",
        "id": "line-1633958724322",
        "label": "Update Record to Pending Company User APPROVE",
        "targetLabel": "Email Task (Mentor-CompanyUser)",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "node1633958637498-right",
        "target": "node1613390323051",
        "endSocket": "left",
        "id": "line-1633958727119",
        "label": "Email Task (Mentor-CompanyUser)",
        "targetLabel": "Company User Approve",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "node1615900642216-right",
        "target": "node1633959329261",
        "endSocket": "left",
        "id": "line-1633959380001",
        "label": "Update Record to Pending MENTOR APPROVE",
        "targetLabel": "Email Task  (Company User->Mentor)",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "node1633959329261-right",
        "target": "node1615907920654",
        "endSocket": "left",
        "id": "line-1633959382895",
        "label": "Email Task  (Company User->Mentor)",
        "targetLabel": "Mentor Approve",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "node1613390905626-right",
        "target": "node1633959446104",
        "endSocket": "left",
        "id": "line-1633959467004",
        "label": "Company User Update Record to Booked",
        "targetLabel": "Email Task (Mentor->CompanyUser) Response",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "node1615908052024-right",
        "target": "node1633959638767",
        "endSocket": "left",
        "id": "line-1633959774085",
        "label": "Mentor Update Record to Booked",
        "targetLabel": "Email Task (CompanyUser->Mentor) Response",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "node1633959638767-right",
        "target": "node1636971583639",
        "endSocket": "left",
        "id": "line-1636971776959",
        "label": "Email Task (CompanyUser->Mentor) Response",
        "targetLabel": "ICS file send to mentor",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "node1636971583639-right",
        "target": "node1615908105291",
        "endSocket": "left",
        "id": "line-1636971779636",
        "label": "ICS file send to mentor",
        "targetLabel": "Did Session Happen? Mentor",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "node1633959446104-right",
        "target": "node1636972398889",
        "endSocket": "left",
        "id": "line-1636972514123",
        "label": "Email Task (Mentor->CompanyUser) Response",
        "targetLabel": "ICS file send to company user",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      },
      {
        "source": "node1636972398889-right",
        "target": "node1613463136747",
        "endSocket": "left",
        "id": "line-1636972516654",
        "label": "ICS file send to company user",
        "targetLabel": "Did Session Happen? Company User",
        "type": {
          "startPlug": "behind",
          "color": "#5e73e4",
          "size": 2,
          "path": "grid",
          "dash": null
        }
      }
    ],
    "transform": {
      "x": -442.299181839628,
      "y": 122.31097665011862,
      "scale": 0.597186845099943
    }
  },
  "name": "Sessions",
  "scheduled": false
}